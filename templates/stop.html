{% extends "base.html" %}

{% block head %}
{{ super() }}
	<style>
	.loader {
		position: fixed;
		top: 62px;
		left: -8px;
		width: 10px;
		height: 10px;
		border: 2px solid #f3f3f3;
		border-top: 2px solid #3498db;
	}
	.load-time {
		color: white;
		background: #ee3124;
		display: inline-block;
		margin-top: 25px;
		padding: 2px;
		margin-left: 15px;
	}
	</style>
{% endblock %}

{% block content %}
	<h2 id="title" class="stop-title"><button class="fa fa-star"></button>{{ stop_name }}</h2>
	<div id="insert"></div>
	<div class="loader" style="display:block"></div>
	<div class="error"></div>
	<div id="no-filtered-results"></div>
	<p style="display:none;" class="load-time"></p>
	<p style="display:none;" id="current-filters-parent">Active filters (<a id='filter-update-toggle'>update</a>): <span id="current-filters"></span></p>
{% endblock %}

{% block footer %}
{{ super() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="{{ url_for('static', filename='js/stop.js') }}"></script>
<script src="{{ url_for('static', filename='js/favorites.js') }}"></script>
<script src="{{ url_for('static', filename='js/filter.js') }}"></script>
<script>
function request_stop_data() {
	$.get("/{{ stop_id | safe }}", function(responseText) {
		json = responseText;
	}).done(function() {
		if (json == "") {
			$('.loader').hide();
			$('#insert').html("");
			$('.error').html("<p>There was an error getting the requested data. Please try again later.</p>");
			return
		}
		$('#insert').html("");
		parseStopData();
		getTimeColor();
		updateActiveFilterButtons();
		printActiveFilters();
		showHideDepartures();
		$('.loader').hide();
		$('.load-time').html( "Loaded at: " + moment().format('h:mm A') );
		$('.load-time').show();
		$('#current-filters-parent').show();
	});
}

$(document).ready(function() {
	request_stop_data();
	setInterval(function() {
		$('.loader').show();
		request_stop_data();
	}, 30 * 1000); // x * 1000 milsec

	document.title = "{{ stop_name | safe }}" + " | MTD"

	$('.route-short-filter').click(function() {
		updateSavedFilters( $(this) );
		updateActiveFilterButtons();
		printActiveFilters();
		showHideDepartures();
	});

	checkIfStopIsFavorite("{{ stop_name | safe }}");
	$('.fa-star').click(function() {
		addRemoveFavorite( $(this), "{{ stop_id | safe }}", "{{ stop_name | safe }}" );
	});

})
</script>
{% endblock %}





