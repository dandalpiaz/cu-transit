{% extends "base.html" %}
{% block content %}

<h2 id="title">Search:</h2>

<div class="search-wrap">
    <input autocomplete="off" type="" id="searchTxt" placeholder="Search for Stops">
</div>

<div>
	<ul id="result">
	</ul>
</div>

<h2 id="title">Favorites:</h2>

<ul class="favorites">
	<li>[[[[[TBD]]]]]</li>
	<li>[[[[[TBD]]]]]</li>
	<li>[[[[[TBD]]]]]</li>
</ul>

{% endblock %}

{% block footer %}
{{ super() }}

<script>

/*
window.onload = function() {
  var input = document.getElementById("searchTxt").focus();
} */

var delay = (function(){
	var timer = 0;
	return function(callback, ms){
	  clearTimeout (timer);
	  timer = setTimeout(callback, ms);
	};
})();

function getData() {
    searchVar = document.getElementById("searchTxt").value;
    if (searchVar == "") {
		return
	}

    baseUrl = "https://search.mtd.org/v1.0.0/stop/suggest/";
    url = baseUrl + searchVar;

	$('#result').html("");
    $.getJSON(url, function(data) {
		for (i = 0; i < data.length; i++) {
			stopName = data[i]['result']['name'];
			stopID = data[i]['result']['id'];
			$('#result').append("<li>" + "<a href='/stop=" + stopID + "'>" + stopName + "</a>" + "</li>");
		}
    });       
};

$( document ).ready(function() {
    $("#searchTxt").keyup(function(){
        console.log("keyup on input")
		delay(function(){
			getData();
		}, 500 );
	});
});
            
</script>

{% endblock %}